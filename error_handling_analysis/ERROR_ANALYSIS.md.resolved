# HTTP Stack Error Handling Analysis

## 1. Error Codes

### Connection Errors (`net/base/net_errors.h`)
Range: -100 to -199
- `ERR_CONNECTION_CLOSED` (-100): Connection closed (TCP FIN).
- `ERR_CONNECTION_RESET` (-101): Connection reset (TCP RST).
- `ERR_CONNECTION_REFUSED` (-102): Connection refused.
- `ERR_CONNECTION_ABORTED` (-103): Connection aborted (timeout waiting for ACK).
- `ERR_CONNECTION_FAILED` (-104): Generic connection failure.
- `ERR_NAME_NOT_RESOLVED` (-105): Host resolution failed.
- `ERR_INTERNET_DISCONNECTED` (-106): Internet disconnected.
- `ERR_SSL_PROTOCOL_ERROR` (-107): SSL protocol error.
- `ERR_ADDRESS_INVALID` (-108): Invalid IP/Port.
- `ERR_ADDRESS_UNREACHABLE` (-109): IP unreachable.
- `ERR_SSL_CLIENT_AUTH_CERT_NEEDED` (-110): Client cert required.
- `ERR_TUNNEL_CONNECTION_FAILED` (-111): Proxy tunnel failed.
- `ERR_SSL_VERSION_OR_CIPHER_MISMATCH` (-113): SSL version/cipher mismatch.
- `ERR_SSL_RENEGOTIATION_REQUESTED` (-114): Renegotiation requested.
- `ERR_PROXY_AUTH_UNSUPPORTED` (-115): Unsupported proxy auth.
- `ERR_BAD_SSL_CLIENT_AUTH_CERT` (-117): Bad client cert.
- `ERR_CONNECTION_TIMED_OUT` (-118): Connection timed out.
- `ERR_HOST_RESOLVER_QUEUE_TOO_LARGE` (-119): DNS queue too large.
- `ERR_SOCKS_CONNECTION_FAILED` (-120): SOCKS connection failed.
- `ERR_SOCKS_CONNECTION_HOST_UNREACHABLE` (-121): SOCKS host unreachable.
- `ERR_ALPN_NEGOTIATION_FAILED` (-122): ALPN/NextProto negotiation failed.
- `ERR_SSL_NO_RENEGOTIATION` (-123): Peer sent no_renegotiation.
- `ERR_WINSOCK_UNEXPECTED_WRITTEN_BYTES` (-124): Winsock error.
- `ERR_SSL_DECOMPRESSION_FAILURE_ALERT` (-125): SSL decompression failure.
- `ERR_SSL_BAD_RECORD_MAC_ALERT` (-126): SSL bad record MAC.
- `ERR_PROXY_AUTH_REQUESTED` (-127): Proxy auth requested (Tunnel).
- `ERR_PROXY_CONNECTION_FAILED` (-130): Proxy connection failed (Name/Socket).
- `ERR_MANDATORY_PROXY_CONFIGURATION_FAILED` (-131): Mandatory proxy config failed.
- `ERR_PRECONNECT_MAX_SOCKET_LIMIT` (-133): Max socket limit reached during preconnect.
- `ERR_SSL_CLIENT_AUTH_PRIVATE_KEY_ACCESS_DENIED` (-134): Private key access denied.
- `ERR_SSL_CLIENT_AUTH_CERT_NO_PRIVATE_KEY` (-135): No private key for cert.
- `ERR_PROXY_CERTIFICATE_INVALID` (-136): Proxy cert invalid.
- `ERR_NAME_RESOLUTION_FAILED` (-137): DNS resolution failed.
- `ERR_NETWORK_ACCESS_DENIED` (-138): Network access denied (Firewall).
- `ERR_TEMPORARILY_THROTTLED` (-139): Request throttled (DDOS protection).
- `ERR_SSL_CLIENT_AUTH_SIGNATURE_FAILED` (-141): Client auth signature failed.
- `ERR_MSG_TOO_BIG` (-142): Message too big (UDP).
- `ERR_WS_PROTOCOL_ERROR` (-145): WebSocket protocol error.
- `ERR_ADDRESS_IN_USE` (-147): Address in use (Bind).
- `ERR_SSL_PINNED_KEY_NOT_IN_CERT_CHAIN` (-150): Pinned key missing.
- `ERR_CLIENT_AUTH_CERT_TYPE_UNSUPPORTED` (-151): Client auth cert type unsupported.
- `ERR_SSL_DECRYPT_ERROR_ALERT` (-153): SSL decrypt error.
- `ERR_WS_THROTTLE_QUEUE_TOO_LARGE` (-154): WebSocket throttle queue full.
- `ERR_SSL_SERVER_CERT_CHANGED` (-156): Server cert changed (Renegotiation).
- `ERR_SSL_UNRECOGNIZED_NAME_ALERT` (-159): SSL unrecognized name.
- `ERR_SOCKET_SET_RECEIVE_BUFFER_SIZE_ERROR` (-160): Set receive buffer failed.
- `ERR_SOCKET_SET_SEND_BUFFER_SIZE_ERROR` (-161): Set send buffer failed.
- `ERR_SOCKET_RECEIVE_BUFFER_SIZE_UNCHANGEABLE` (-162): Receive buffer unchangeable.
- `ERR_SOCKET_SEND_BUFFER_SIZE_UNCHANGEABLE` (-163): Send buffer unchangeable.
- `ERR_SSL_CLIENT_AUTH_CERT_BAD_FORMAT` (-164): Client cert bad format.
- `ERR_ICANN_NAME_COLLISION` (-166): ICANN name collision.
- `ERR_SSL_SERVER_CERT_BAD_FORMAT` (-167): Server cert bad format.
- `ERR_CT_STH_PARSING_FAILED` (-168): CT STH parsing failed.
- `ERR_CT_STH_INCOMPLETE` (-169): CT STH incomplete.
- `ERR_UNABLE_TO_REUSE_CONNECTION_FOR_PROXY_AUTH` (-170): Cannot reuse connection for proxy auth.
- `ERR_CT_CONSISTENCY_PROOF_PARSING_FAILED` (-171): CT proof parsing failed.
- `ERR_SSL_OBSOLETE_CIPHER` (-172): SSL obsolete cipher.
- `ERR_WS_UPGRADE` (-173): WS upgrade successful (Internal).
- `ERR_READ_IF_READY_NOT_IMPLEMENTED` (-174): ReadIfReady not implemented (Internal).
- `ERR_NO_BUFFER_SPACE` (-176): No buffer space.
- `ERR_SSL_CLIENT_AUTH_NO_COMMON_ALGORITHMS` (-177): No common signature algs.
- `ERR_EARLY_DATA_REJECTED` (-178): TLS 1.3 early data rejected.
- `ERR_WRONG_VERSION_ON_EARLY_DATA` (-179): TLS 1.3 early data version mismatch.
- `ERR_TLS13_DOWNGRADE_DETECTED` (-180): TLS 1.3 downgrade detected.
- `ERR_SSL_KEY_USAGE_INCOMPATIBLE` (-181): Key usage incompatible.
- `ERR_INVALID_ECH_CONFIG_LIST` (-182): Invalid ECH config.
- `ERR_ECH_NOT_NEGOTIATED` (-183): ECH not negotiated.
- `ERR_ECH_FALLBACK_CERTIFICATE_INVALID` (-184): ECH fallback cert invalid.
- `ERR_PROXY_UNABLE_TO_CONNECT_TO_DESTINATION` (-186): Proxy cannot connect to dest.
- `ERR_PROXY_DELEGATE_CANCELED_CONNECT_REQUEST` (-187): Proxy delegate canceled (Request).
- `ERR_PROXY_DELEGATE_CANCELED_CONNECT_RESPONSE` (-188): Proxy delegate canceled (Response).

### HTTP Errors (`net/base/net_errors.h`)
Range: -300 to -399
- `ERR_INVALID_URL` (-300): Invalid URL.
- `ERR_DISALLOWED_URL_SCHEME` (-301): Disallowed scheme.
- `ERR_UNKNOWN_URL_SCHEME` (-302): Unknown scheme.
- `ERR_INVALID_REDIRECT` (-303): Invalid redirect.
- `ERR_TOO_MANY_REDIRECTS` (-310): Too many redirects.
- `ERR_UNSAFE_REDIRECT` (-311): Unsafe redirect.
- `ERR_UNSAFE_PORT` (-312): Unsafe port.
- `ERR_INVALID_RESPONSE` (-320): Invalid response.
- `ERR_INVALID_CHUNKED_ENCODING` (-321): Invalid chunked encoding.
- `ERR_METHOD_NOT_SUPPORTED` (-322): Method not supported.
- `ERR_UNEXPECTED_PROXY_AUTH` (-323): Unexpected proxy auth.
- `ERR_EMPTY_RESPONSE` (-324): Empty response.
- `ERR_RESPONSE_HEADERS_TOO_BIG` (-325): Headers too big.
- `ERR_PAC_SCRIPT_FAILED` (-327): PAC script failed.
- `ERR_REQUEST_RANGE_NOT_SATISFIABLE` (-328): Range not satisfiable.
- `ERR_MALFORMED_IDENTITY` (-329): Malformed identity.
- `ERR_CONTENT_DECODING_FAILED` (-330): Content decoding failed.
- `ERR_NETWORK_IO_SUSPENDED` (-331): Network IO suspended.
- `ERR_NO_SUPPORTED_PROXIES` (-336): No supported proxies.
- `ERR_HTTP2_PROTOCOL_ERROR` (-337): HTTP/2 protocol error.
- `ERR_INVALID_AUTH_CREDENTIALS` (-338): Invalid auth credentials.
- `ERR_UNSUPPORTED_AUTH_SCHEME` (-339): Unsupported auth scheme.
- `ERR_ENCODING_DETECTION_FAILED` (-340): Encoding detection failed.
- `ERR_MISSING_AUTH_CREDENTIALS` (-341): Missing auth credentials (GSSAPI).
- `ERR_UNEXPECTED_SECURITY_LIBRARY_STATUS` (-342): Unexpected security lib status.
- `ERR_MISCONFIGURED_AUTH_ENVIRONMENT` (-343): Misconfigured auth env.
- `ERR_UNDOCUMENTED_SECURITY_LIBRARY_STATUS` (-344): Undocumented security lib status.
- `ERR_RESPONSE_BODY_TOO_BIG_TO_DRAIN` (-345): Body too big to drain.
- `ERR_RESPONSE_HEADERS_MULTIPLE_CONTENT_LENGTH` (-346): Multiple Content-Length.
- `ERR_INCOMPLETE_HTTP2_HEADERS` (-347): Incomplete HTTP/2 headers.
- `ERR_PAC_NOT_IN_DHCP` (-348): PAC not in DHCP.
- `ERR_RESPONSE_HEADERS_MULTIPLE_CONTENT_DISPOSITION` (-349): Multiple Content-Disposition.
- `ERR_RESPONSE_HEADERS_MULTIPLE_LOCATION` (-350): Multiple Location.
- `ERR_HTTP2_SERVER_REFUSED_STREAM` (-351): HTTP/2 server refused stream.
- `ERR_HTTP2_PING_FAILED` (-352): HTTP/2 PING failed.
- `ERR_CONTENT_LENGTH_MISMATCH` (-354): Content-Length mismatch.
- `ERR_INCOMPLETE_CHUNKED_ENCODING` (-355): Incomplete chunked encoding.
- `ERR_QUIC_PROTOCOL_ERROR` (-356): QUIC protocol error.
- `ERR_RESPONSE_HEADERS_TRUNCATED` (-357): Headers truncated.
- `ERR_QUIC_HANDSHAKE_FAILED` (-358): QUIC handshake failed.
- `ERR_HTTP2_INADEQUATE_TRANSPORT_SECURITY` (-360): HTTP/2 inadequate security.
- `ERR_HTTP2_FLOW_CONTROL_ERROR` (-361): HTTP/2 flow control error.
- `ERR_HTTP2_FRAME_SIZE_ERROR` (-362): HTTP/2 frame size error.
- `ERR_HTTP2_COMPRESSION_ERROR` (-363): HTTP/2 compression error.
- `ERR_PROXY_AUTH_REQUESTED_WITH_NO_CONNECTION` (-364): Proxy auth no connection.
- `ERR_HTTP_1_1_REQUIRED` (-365): HTTP/1.1 required.
- `ERR_PROXY_HTTP_1_1_REQUIRED` (-366): Proxy HTTP/1.1 required.
- `ERR_PAC_SCRIPT_TERMINATED` (-367): PAC script terminated.
- `ERR_PROXY_REQUIRED` (-368): Proxy required (IPP).
- `ERR_INVALID_HTTP_RESPONSE` (-370): Invalid HTTP response (0.9 vs 1.x).
- `ERR_CONTENT_DECODING_INIT_FAILED` (-371): Content decoding init failed.
- `ERR_HTTP2_RST_STREAM_NO_ERROR_RECEIVED` (-372): HTTP/2 RST_STREAM NO_ERROR.
- `ERR_HTTP2_PUSHED_STREAM_NOT_AVAILABLE` (-373): Pushed stream not available.
- `ERR_HTTP2_CLAIMED_PUSHED_STREAM_RESET_BY_SERVER` (-374): Claimed pushed stream reset.
- `ERR_TOO_MANY_RETRIES` (-375): Too many retries.
- `ERR_HTTP2_STREAM_CLOSED` (-376): HTTP/2 stream closed.
- `ERR_HTTP2_CLIENT_REFUSED_STREAM` (-377): Client refused stream.
- `ERR_HTTP2_PUSHED_RESPONSE_DOES_NOT_MATCH` (-378): Pushed response doesn't match.

## 2. Retry Logic in `HttpNetworkTransaction`

### Max Retries
`kMaxRetryAttempts = 2`

### Retryable Errors
The following errors trigger a retry (via `GetRetryReasonForIOError`):
- `ERR_CONNECTION_RESET`
- `ERR_CONNECTION_CLOSED`
- `ERR_CONNECTION_ABORTED`
- `ERR_SOCKET_NOT_CONNECTED`
- `ERR_EMPTY_RESPONSE`
- `ERR_EARLY_DATA_REJECTED`
- `ERR_WRONG_VERSION_ON_EARLY_DATA`
- `ERR_HTTP2_PING_FAILED`
- `ERR_HTTP2_SERVER_REFUSED_STREAM`
- `ERR_QUIC_HANDSHAKE_FAILED`
- `ERR_QUIC_PROTOCOL_ERROR` (if applicable)

### Backoff
There is no explicit exponential backoff for these immediate network transaction retries in this layer. The retry seems to happen immediately by clearing the stream and restarting the state machine (`ResetConnectionAndRequestForResend`).

## 3. Auth Challenges
Auth challenges are handled by `RestartWithAuth`.
- Triggers: `HTTP_UNAUTHORIZED` (401) or `HTTP_PROXY_AUTHENTICATION_REQUIRED` (407).
  - Note: These are HTTP Status Codes, not Net Errors.
- `ERR_SSL_CLIENT_AUTH_CERT_NEEDED` triggers `RestartWithCertificate`.

## 4. Fatal Errors
Any error NOT listed in the retryable list is generally treated as fatal for the transaction, unless handled by a higher layer (e.g. `URLRequestHttpJob` handling certificate errors).
